<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>IoT Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .card { padding: 20px; border-radius: 10px; background: #f5f5f5; margin-bottom: 20px; }
        .status-open { color: green; font-weight: bold; }
        .status-closed { color: red; font-weight: bold; }
    </style>
</head>
<body>

<h1>IoT Dashboard</h1>

<div class="card">
    <h2>Status drzwi</h2>
    <p id="doorStatusText" class="status-closed">≈Åadowanie...</p>
    <p id="alarmText" style="display:none;">Alarm: <span id="alarmValue">0</span></p>
</div>

<div class="card">
    <h2>Wykres temperatury (¬∞C)</h2>
    <canvas id="tempChart"></canvas>
</div>

<div class="card">
    <h2>Wykres wilgotno≈õci (%)</h2>
    <canvas id="humChart"></canvas>
</div>

<div class="card">
    <h2>Wykres ci≈õnienia (hPa)</h2>
    <canvas id="presChart"></canvas>
</div>

<script>
    // 1. Inicjalizacja pustych wykres√≥w (dane przyjdƒÖ z API)
    const ctxTemp = document.getElementById("tempChart").getContext('2d');
    const ctxHum = document.getElementById("humChart").getContext('2d');
    const ctxPres = document.getElementById("presChart").getContext('2d');

    // Funkcja pomocnicza do tworzenia configu wykresu
    function createChartConfig(label, color) {
        return {
            type: "line",
            data: {
                labels: [], // Puste na start
                datasets: [{
                    label: label,
                    data: [], // Puste na start
                    borderColor: color,
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                }]
            },
            options: { animation: false } // Wy≈ÇƒÖczamy animacjƒô przy od≈õwie≈ºaniu, ≈ºeby nie "skaka≈Ço"
        };
    }

    // Tworzymy obiekty wykres√≥w i przypisujemy do zmiennych
    const tempChart = new Chart(ctxTemp, createChartConfig("Temperatura (¬∞C)", "red"));
    const humChart = new Chart(ctxHum, createChartConfig("Wilgotno≈õƒá (%)", "blue"));
    const presChart = new Chart(ctxPres, createChartConfig("Ci≈õnienie (hPa)", "green"));

    // 2. Funkcja pobierajƒÖca dane i aktualizujƒÖca dashboard
    function updateDashboard() {
        fetch('/api/dashboard-data/')  // <-- Tutaj wpisz URL do swojego widoku JSON
            .then(response => response.json())
            .then(data => {
                
                // Aktualizacja Wykres√≥w
                // Temperatura
                tempChart.data.labels = data.timestamps;
                tempChart.data.datasets[0].data = data.temperatures;
                tempChart.update();

                // Wilgotno≈õƒá
                humChart.data.labels = data.timestamps;
                humChart.data.datasets[0].data = data.humidities;
                humChart.update();

                // Ci≈õnienie
                presChart.data.labels = data.timestamps;
                presChart.data.datasets[0].data = data.pressures;
                presChart.update();

                // Aktualizacja Statusu Drzwi
                const doorText = document.getElementById('doorStatusText');
                if (data.door_open) {
                    doorText.textContent = "üö™ Otwarte";
                    doorText.className = "status-open";
                } else {
                    doorText.textContent = "üö™ Zamkniƒôte";
                    doorText.className = "status-closed";
                }

                // Aktualizacja Alarmu
                const alarmContainer = document.getElementById('alarmText');
                if (data.alarm > 0) {
                    alarmContainer.style.display = 'block';
                    document.getElementById('alarmValue').textContent = data.alarm;
                } else {
                    alarmContainer.style.display = 'none';
                }
            })
            .catch(error => console.error('B≈ÇƒÖd pobierania danych:', error));
    }

    // 3. Uruchomienie pƒôtli
    updateDashboard(); // Wywo≈Çaj raz na start
    setInterval(updateDashboard, 1000); // Wywo≈Çuj co 1000ms (1 sekund)

</script>

</body>
</html>
